#!/bin/sh -eu

# Install eyes as a macOS Launch Agent for auto-start on login

PROJECT_DIR="$(pwd)"
PLIST_NAME="com.eyes.plist"
PLIST_DIR="$HOME/Library/LaunchAgents"
PLIST_PATH="$PLIST_DIR/$PLIST_NAME"

# Check if we're in the project directory
if [ ! -f "pyproject.toml" ]; then
    echo "Error: Run this script from the eyes project directory"
    exit 1
fi

# Create LaunchAgents directory if it doesn't exist
mkdir -p "$PLIST_DIR"

# Create plist with correct path
sed "s|EYES_PATH_PLACEHOLDER|$PROJECT_DIR|g" scripts/com.eyes.plist > "$PLIST_PATH"

# Load the launch agent
launchctl load "$PLIST_PATH"

echo "Eyes installed as Launch Agent!"
echo "It will start automatically on login with 20-minute intervals."
echo ""
echo "To uninstall:"
echo "  launchctl unload '$PLIST_PATH'"
echo "  rm '$PLIST_PATH'"
echo ""
echo "To check status:"
echo "  launchctl list | grep com.eyes"